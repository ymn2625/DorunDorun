<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>boardHome</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0; /* 배경색 */
            color: #333; /* 글자색 */
        }

        button {
            background-color: #1abc9c; /* 버튼 배경색 */
            color: #fff; /* 버튼 글자색 */
            border: none;
            border-radius: 3px;
            padding: 10px 20px;
            margin: 10px;
            cursor: pointer;
        }

        button:hover {
            background-color: #148f77; /* 마우스 호버시 배경색 */
        }

        select, input[type="text"] {
            padding: 10px;
            margin: 10px;
            border: 1px solid #ccc; /* 입력창 테두리 */
            border-radius: 3px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 10px;
            border: 1px solid #ccc;
        }

        th {
            background-color: #ff69b4; /* 테이블 헤더 배경색 */
            color: #fff; /* 테이블 헤더 글자색 */
            text-align: left;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2; /* 짝수 줄 배경색 */
        }

        a {
            text-decoration: none; /* 링크에 밑줄 제거 */
            color: #1abc9c; /* 링크 색상 */
        }

        a:hover {
            color: #148f77; /* 마우스 호버시 링크 색상 */
        }

        .page {
            text-align: center;
            font-size: 20px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
</head>
<body>
<button onclick="location.href='/board/write'">글 작성</button>
<form action="/board/home?page=1" method="get">
    <select name="searchCondition" id="searchCondition">
        <option th:each="entry : ${conditionMap.entrySet()}"
                th:value="${entry.value}"
                th:text="${entry.key}">
        </option>
    </select>
    <input name="searchKeyword" type="text" id="searchKeyword" th:value="${keyword}">
    <input type="submit" value="검색">
</form>
<button onclick="showAll()">전체</button>
<button onclick="showNotice()">공지</button>
<button onclick="showFreeBoard()">자유</button>
<button onclick="showReview()">후기</button>

<div id="categoryTable">
    <table>
        <tr>
            <th>글 번호</th>
            <th>글 제목</th>
            <th>작성자</th>
            <th>작성시간</th>
            <th>조회수</th>
        </tr>
        <tr th:each="board: ${boardList}" id="mmmmmm">
            <td th:text="${board.boardId}"></td>
            <td>
                <a th:href="@{|/board/detail/${board.boardId}|(page=${boardList.number + 1})}">
                    [<span th:text="${board.boardCategory}"></span>]
                    <span th:text="${board.boardTitle}"></span>
                </a>
            </td>
            <td th:text="${board.memberNickname}"></td>
            <td th:text="*{#temporals.format(board.boardCreatedTime, 'yyyy-MM-dd HH:mm')}"></td>
            <td th:text="${board.boardHits}"></td>
        </tr>
    </table>
    <!-- 첫번째 페이지로 이동 page=1을 소괄호 안에 작성(query-string으로 변경해주는 thymeleaf 문법) -->
    <!-- /board/paging?page=1 -->
    <div class="page">
        <a class="page" th:href="@{/board/home(page=1, searchKeyword=${keyword}, searchCondition=${condition}, boardCategory=${category})}" th:if="${not #strings.isEmpty(keyword)}">&lt;&lt;</a>
        <a class="page" th:href="@{/board/home(page=1, boardCategory=${category})}" th:if="${#strings.isEmpty(keyword)} and ${not #strings.isEmpty(category)}">&lt;&lt;</a>
        <a class="page" th:href="@{/board/home(page=1)}" th:if="${#strings.isEmpty(keyword)} and ${#strings.isEmpty(category)}">&lt;&lt;</a>
        <!-- boardList.getNumber() 사용자:2페이지 getNumber()=1 -->
        <!--boardList.getNumber를 호출한 것이 boardList.number/ 아까 설정해준 page = number-->
        <a class="page" th:href="${boardList.first} ? '#' : @{/board/home(page=${boardList.number}, searchKeyword=${keyword}, searchCondition=${condition}, boardCategory=${category})}" th:if="${not #strings.isEmpty(keyword)}">&lt;</a>
        <a class="page" th:href="${boardList.first} ? '#' : @{/board/home(page=${boardList.number}, boardCategory=${category})}" th:if="${#strings.isEmpty(keyword)} and ${not #strings.isEmpty(category)}">&lt;</a>
        <a class="page" th:href="${boardList.first} ? '#' : @{/board/home(page=${boardList.number})}" th:if="${#strings.isEmpty(keyword)} and ${#strings.isEmpty(category)}">&lt;</a>
        <!-- 페이지 번호 링크(현재 페이지는 숫자만)
                for(int page=startPage; page<=endPage; page++)-->
        <span class="page" th:each="page: ${#numbers.sequence(startPage, endPage)}">
            <!-- 현재페이지는 링크 없이 숫자만 -->
            <!--그 안에서 페이지가 number 세팅 +1(number는 -1된 값이므로)이라면 page는 span처리-->
            <span class="page" th:if="${page == boardList.number + 1}" th:text="${page}"></span>
            <!-- 현재페이지 번호가 아닌 다른 페이지번호에는 링크를 보여줌 -->
            <span class="page" th:if="${page != boardList.number + 1 && page !=0}">
                    <a class="page" th:href="@{/board/home(page=${page}, searchKeyword=${keyword}, searchCondition=${condition}, boardCategory=${category})}" th:text="${page}" th:if="${not #strings.isEmpty(keyword)}"></a>
                    <a class="page" th:href="@{/board/home(page=${page}, boardCategory=${category})}" th:if="${#strings.isEmpty(keyword)} and ${not #strings.isEmpty(category)}" th:text="${page}"></a>
                    <a class="page" th:href="@{/board/home(page=${page})}" th:if="${#strings.isEmpty(keyword)} and ${#strings.isEmpty(category)}" th:text="${page}"></a>
            </span>
        </span>
        <!--prev의 반대이며, number가 +1 해줘야 현재 페이지이므로 +2로 다음페이지로 넘긴다-->
        <a class="page" th:href="${boardList.last} ? '#' : @{/board/home(page=${boardList.number + 2}, searchKeyword=${keyword}, searchCondition=${condition}, boardCategory=${category})}" th:if="${not #strings.isEmpty(keyword)}">&gt;</a>
        <a class="page" th:href="${boardList.last} ? '#' : @{/board/home(page=${boardList.number + 2}, boardCategory=${category})}" th:if="${#strings.isEmpty(keyword)} and ${not #strings.isEmpty(category)}">&gt;</a>
        <a class="page" th:href="${boardList.last} ? '#' : @{/board/home(page=${boardList.number + 2})}" th:if="${#strings.isEmpty(keyword)} and ${#strings.isEmpty(category)}">&gt;</a>
        <!-- 마지막 페이지로 이동 -->
        <a class="page" th:href="@{/board/home(page=${boardList.totalPages}, searchKeyword=${keyword}, searchCondition=${condition}, boardCategory=${category})}" th:if="${not #strings.isEmpty(keyword)}">&gt;&gt;</a>
        <a class="page" th:href="@{/board/home(page=${boardList.totalPages}, searchKeyword=${keyword}, boardCategory=${category})}" th:if="${#strings.isEmpty(keyword)} and ${not #strings.isEmpty(category)}">&gt;&gt;</a>
        <a class="page" th:href="@{/board/home(page=${boardList.totalPages}, searchKeyword=${keyword})}" th:if="${#strings.isEmpty(keyword)} and ${#strings.isEmpty(category)}">&gt;&gt;</a>
    </div>
</div>
<div id="firstBoardModal" style="display: none; position: fixed; z-index: 999; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgb(0,0,0); background-color: rgba(0,0,0,0.4);">
    <div style="background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; text-align: center;">
        <span style="float: right; font-size: 28px; font-weight: bold; cursor: pointer;" onclick="closeFirstLoginModal()">&times;</span>
        <h2>배지 획득!</h2>
        <img src="/img/FirstBoardWrite.png" alt="첫 게시물 작성 배지">
        <p>첫 게시물 작성 배지 획득!</p>
    </div>
</div>
<div id="tenBoardModal" style="display: none; position: fixed; z-index: 999; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgb(0,0,0); background-color: rgba(0,0,0,0.4);">
    <div style="background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; text-align: center;">
        <span style="float: right; font-size: 28px; font-weight: bold; cursor: pointer;" onclick="closeFirstLoginModal()">&times;</span>
        <h2>배지 획득!</h2>
        <img src="/img/10BoardWrite.png" alt="10번째 게시물 작성 배지">
        <p>10번째 게시물 작성 배지 획득!</p>
    </div>
</div>
<div id="fiftyBoardModal" style="display: none; position: fixed; z-index: 999; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgb(0,0,0); background-color: rgba(0,0,0,0.4);">
    <div style="background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; text-align: center;">
        <span style="float: right; font-size: 28px; font-weight: bold; cursor: pointer;" onclick="closeFirstLoginModal()">&times;</span>
        <h2>배지 획득!</h2>
        <img src="/img/50BoardWrite.png" alt="50번째 게시물 작성 배지">
        <p>50번째 게시물 작성 배지 획득!</p>
    </div>
</div>
<div id="hundredBoardModal" style="display: none; position: fixed; z-index: 999; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgb(0,0,0); background-color: rgba(0,0,0,0.4);">
    <div style="background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; text-align: center;">
        <span style="float: right; font-size: 28px; font-weight: bold; cursor: pointer;" onclick="closeFirstLoginModal()">&times;</span>
        <h2>배지 획득!</h2>
        <img src="/img/100BoardWrite.png" alt="100번째 게시물 작성 배지">
        <p>100번째 게시물 작성 배지 획득!</p>
    </div>
</div>
    <script th:inline="javascript">
        $(function (){
            const canGetBadge = [[${canGetBadge}]];
            console.log(canGetBadge);
            if(canGetBadge==1){
                $('#firstBoardModal').css('display','block');
            }else if(canGetBadge == 2){
                $('#tenBoardModal').css('display','block');
            }else if(canGetBadge == 3){
                $('#fiftyBoardModal').css('display','block');
            }else if(canGetBadge == 4){
                $('#hundredBoardModal').css('display','block');
            }
        });

        function closeFirstLoginModal() {
            $('#firstBoardModal').hide();
            $('#tenBoardModal').hide();
            $('#fiftyBoardModal').hide();
            $('#hundredBoardModal').hide();
        }
        const showAll = () =>{
            let query = "/board/home?";
            let keyword = [[${keyword}]];
            let condition = [[${condition}]];
            if(keyword != null){
                query += "searchKeyword=" + keyword + "&searchCondition=" + condition;
            }
            window.location.href = query;
        }
        const showNotice = ()=>{
            let query = "/board/home?";
            let keyword = [[${keyword}]];
            let condition = [[${condition}]];
            if(keyword != null){
                query += "searchKeyword=" + keyword + "&searchCondition=" + condition + "&";
            }
            query += "boardCategory=공지"
            window.location.href = query;
        }
        const showFreeBoard = () =>{
            let query = "/board/home?";
            let keyword = [[${keyword}]];
            let condition = [[${condition}]];
            if(keyword != null){
                query += "searchKeyword=" + keyword + "&searchCondition=" + condition + "&";
            }
            query += "boardCategory=자유"
            window.location.href = query;
        }
        const showReview = () =>{
            let query = "/board/home?";
            let keyword = [[${keyword}]];
            let condition = [[${condition}]];
            if(keyword != null){
                query += "searchKeyword=" + keyword + "&searchCondition=" + condition + "&";
            }
            query += "boardCategory=후기"
            window.location.href = query;
        }
    </script>
<!--
<script th:inline="javascript">
    const showCategory = (button) =>{
        const boardCategory = button.innerText;
        console.log(boardCategory);
        console.log([[${page}]]);
        $.ajax({
            type : "get",
            url : "/board/category",
            data : {
                "boardCategory" : boardCategory,
                "page" : [[${page}]],
                "searchCondition" : [[${condition}]],
                "searchKeyword" : [[${keyword}]]
            },
            success : function (res) {
                let output = "<table>" +
                    "<th>글 번호</th>" +
                    "<th>글 제목</th>" +
                    "<th>작성자</th>" +
                    "<th>작성시간</th>" +
                    "<th>조회수</th>";

                // for (let [key, board] of res.boardList) {
                // Object.entries(res.boardList).forEach(([key, board])=>{
                // res.boardList.forEach(function (board) {
                // res.forEach(function(board){
                // for (let [key, board] of Object.entries(res)) {
                res.boardList.content.forEach(function(board){
                    output += "<tr>";
                    output += "<td>" + board.boardId+ "</td>";
                    output += "<td>";
                    output += "<a href='/board/detail/"+board.boardId+"?page="+(res.boardList.number + 1 )+"'>";
                    output += "[";
                    output += "<span>"+board.boardCategory + "</span>";
                    output += "]";
                    output += "<span>"+board.boardTitle + "</span>";
                    output += "</a>";
                    output += "</td>";
                    output += "<td>"+ board.memberNickname +"</td>"
                    let date = new Date(board.boardCreatedTime);
                    let formattedDate = date.getFullYear() +"-"+(date.getMonth()+1) +"-"+ date.getDate();
                    output += "<td>"+ formattedDate + "</td>";
                    output += "<td>"+ board.boardHits + "</td>";
                    output += "<tr>";
                });
                output += "</table>";
                output += "<a href='/board/category?page=1&searchKeyword"+res.keyword+"&searchCondition="+res.condition+"&boardCategory="+res.boardCategory+"'> << </a>";
                output += "<a href='" + (res.boardList.first ? '#' : '/board/category?page=' + (res.boardList.number - 1) + '&searchKeyword=' + res.keyword + '&searchCondition=' + res.condition) + '&boardCategory=' + res.boardCategory + "'> < </a>";
                output += "<a href='/board/category?page=" + (res.boardList.number + 1) + "&searchKeyword=" + res.keyword + "&searchCondition=" + res.condition + "&boardCategory=" + res.boardCategory + "'> > </a>";
                output += "<a href='/board/category?page=" + res.boardList.totalPages + "&searchKeyword=" + res.keyword + "&searchCondition=" + res.condition + "&boardCategory=" + res.boardCategory + "'> >> </a>";

                console.log(res.keyword);

                document.getElementById('categoryTable').innerHTML = output;

            },
            error: function (err) {
                console.log(err);
            }
        })
    }
</script>
-->

</body>
</html>