<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>boardDetail</title>
    <script
      src="https://code.jquery.com/jquery-3.6.3.min.js"
      integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU="
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="/css/boardDetail.css" />
  </head>
  <body>

  <form id="crewImage">
    <img id="crew-image" src="" alt="crewImage">
  </form>
  <div class="crewName">

    <p th:text="${crew.crewName}"></p>
    <div class="info">
      <div class="space">
        <img src="../static/img/mapmarker.png" alt="space">
        <span th:text="${crew.crewLocation}"></span>
      </div>
      <div class="np">
        <img src="../static/img/people.png" alt="np">
        <span th:text="${crew.currentMembers} + '명 / ' + ${crew.crewLimit} + '명'"></span>
      </div>
    </div>
  </div>
    <table>
      <tr>
        <th>글 제목</th>
        <td th:text="${board.boardTitle}"></td>
      </tr>
      <tr>
        <th>작성자</th>
        <td th:text="${board.memberNickname}"></td>
      </tr>
      <tr>
        <th>작성일</th>
        <td
          th:text="*{#temporals.format(board.boardCreatedTime, 'yyyy-MM-dd HH:mm')}"
        ></td>
      </tr>
      <tr th:if="${board.boardUpdatedTime != null}">
        <th>수정일</th>
        <td
          th:text="*{#temporals.format(board.boardUpdatedTime, 'yyyy-MM-dd HH:mm')}"
        ></td>
      </tr>
      <tr>
        <th>조회수</th>
        <td th:text="${board.boardHits}"></td>
      </tr>
      <tr>
        <th>글 내용</th>
        <td th:text="${board.boardContent}"></td>
      </tr>
      <tr th:if="${board.fileAttached == 1}">
        <th>image</th>
        <!-- config에서 지정한 경로로 찾아옴 -->
        <td th:each="fileName: ${board.storedFileName}">
          <img th:src="@{|/upload/${fileName}|}" alt="" />
        </td>
      </tr>
    </table>

    <button onclick="listReq()">목록</button>
    <button th:if="${board.memberId == username}" onclick="updateReq()">
      수정
    </button>
    <button th:if="${board.memberId == username}" onclick="deleteReq()">
      삭제
    </button>

    <!--댓글 작성 부분-->
    <div id="comment-write">
      <input type="text" id="commentContents" placeholder="내용" />
      <button id="comment-write-btn" onclick="commentWrite()">댓글작성</button>
    </div>
    <!--댓글 출력 부분-->
    <div id="comment-list">
      <table>
        <tr>
          <th>댓글번호</th>
          <th>작성자</th>
          <th>내용</th>
          <th>작성시간</th>
        </tr>
        <tr th:each="comment: ${commentList}">
          <td th:text="${comment.boardCommentId}"></td>
          <td th:text="${comment.memberNickname}"></td>
          <td th:text="${comment.boardCommentContent}"></td>
          <td th:text="${comment.boardCommentCreatedTime}"></td>
        </tr>
      </table>
    </div>
  </body>
  <script th:inline="javascript">
    const commentWrite = () => {
      const content = document.getElementById("commentContents").value;
      console.log("내용: ", content);
      const id = ["${board.boardId}"];

      $.ajax({
        //요청방식 : POST, 요청주소 : /comment/save, 요청 데이터 : 작성자, 작성내용, 게시글번호
        type: "post",
        url: "/board_comment/save",
        data: {
          boardCommentContent: content,
          boardId: id,
        },
        success: function (res) {
          console.log("요청 성공", res);
          let output = "<table>";
          output += "<tr><th>댓글번호</th>";
          output += "<th>작성자</th>";
          output += "<th>내용</th>";
          output += "<th>작성시간</th></tr>";
          for (let i in res) {
            output += "<tr>";
            output += "<td>" + res[i].boardCommentId + "</td>";
            output += "<td>" + res[i].memberNickname + "</td>";
            output += "<td>" + res[i].boardCommentContent + "</td>";
            output += "<td>" + res[i].boardCommentCreatedTime + "</td>";
            output += "</tr>";
          }
          output += "</table>";
          document.getElementById("comment-list").innerHTML = output;
          document.getElementById("commentContents").value = "";
        },
        error: function (err) {
          console.log("요청 실패", err);
        },
      });
    };

    const listReq = () => {
      console.log("목록 요청");
      location.href = "/board/home?page=" + ["${page}"];
    };
    const updateReq = () => {
      console.log("수정 요청");
      const id = [[${board.boardId}]];
      location.href = "/board/update/" + id;
    };
    const deleteReq = () => {
      console.log("삭제 요청");
      const id = [[${board.boardId}]];
      location.href = "/board/delete/" + id;
    };
  </script>
</html>
